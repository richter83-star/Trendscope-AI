
# BUILD SPECIFICATION: AI Product Trend Forecasting App

## TECH STACK

- **Frontend**: React Native (TypeScript) - iOS/Android
- **Backend**: Node.js + Express.js
- **Database**: PostgreSQL + Redis
- **ML Service**: Python (Flask) with scikit-learn
- **Auth**: Firebase Auth
- **Payments**: Stripe
- **Cloud**: AWS (EC2, RDS, S3)

-----

## BUILD ALL THESE FEATURES

### 1. USER AUTHENTICATION

- Email/password signup and login
- OAuth (Google, Apple Sign-In)
- Password reset flow
- JWT token management
- Session handling with Redis

### 2. SUBSCRIPTION MANAGEMENT

- Three tiers: **Free**, **Starter ($29/mo)**, **Pro ($99/mo)**
- Stripe checkout integration
- Upgrade/downgrade functionality
- Usage tracking and tier limit enforcement
- Stripe webhook handling for subscription events

### 3. PRODUCT SEARCH & DISCOVERY

- Search by keyword, ASIN, or URL
- Real-time autocomplete suggestions
- Filter by: category, price range, marketplace
- Sort by: trend score, price, sales rank
- Pagination (20 results per page)
- Search history tracking

### 4. WATCHLIST (PRODUCT TRACKING)

- Add/remove products from watchlist
- **Tier limits**: Free=10, Starter=50, Pro=500
- Custom list organization (folders)
- Bulk actions (add multiple, delete selected)
- Export watchlist to CSV

### 5. AMAZON INTEGRATION

- **Amazon Product Advertising API (PA-API 5.0)**
- Fetch: title, price, image, BSR, reviews, rating, category
- Historical data collection every 6 hours
- Rate limit handling (1 req/sec)
- Exponential backoff retry logic

### 6. DASHBOARD (HOME SCREEN)

- “Trending Now” widget (top 20 by trend score)
- “My Watchlist” section with real-time updates
- Recent price changes summary
- Portfolio stats: total tracked, average trend score
- Quick action buttons
- Filter by category/marketplace/timeframe

### 7. PRODUCT DETAIL PAGE

- Full product info display
- **Charts**:
  - 30-day price history (line chart)
  - Sales rank trend (line chart)
  - Review count growth (bar chart)
- Competitor comparison table (5 similar products)
- Trend score breakdown by factors
- Estimated monthly sales volume
- Profit calculator (cost → price → margin)
- Add to watchlist button
- Share functionality

### 8. ML TREND SCORING SYSTEM

**Calculate trend score 0-100 based on:**

- **Sales rank velocity (40% weight)**: 7-day & 30-day change
- **Price momentum (30% weight)**: price change patterns
- **Review growth (30% weight)**: new reviews per day

**Classification:**

- Hot: 80-100
- Rising: 60-79
- Stable: 40-59
- Declining: 0-39

Run calculations every 6 hours, store historical scores

### 9. ALERTS & NOTIFICATIONS

**Push notifications via Firebase Cloud Messaging for:**

- Price drops >10% on watchlist items
- Trend score changes >20 points
- New competitors entering market
- Out of stock alerts
- Sales rank improvements >50%

**Additional:**

- In-app notification center
- Email digests (daily/weekly)
- Alert preferences (per-product and global)
- Notification history log

### 10. ANALYTICS & CHARTS

**Using react-native-chart-kit or Victory Native:**

- Line charts: price history, sales rank
- Bar charts: monthly sales estimates
- Area charts: profit margin over time
- Scatter plots: price vs demand positioning
- Date range selector: 7d, 30d, 90d, 1y, custom
- Export charts as images

### 11. COMPETITOR ANALYSIS

- Find similar products by category/keywords
- Side-by-side comparison (up to 5 products)
- Compare: price, BSR, reviews, ratings, trend score
- Price positioning analysis
- Market share estimation
- New seller entry alerts

### 12. API ACCESS (PRO TIER)

- RESTful API with API key authentication
- Rate limit: 1,000 calls/day
- Key endpoints: search, product details, trending, watchlist
- Auto-generated Swagger documentation
- Usage tracking dashboard

-----

## DATABASE SCHEMA

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255),
    subscription_tier VARCHAR(20) DEFAULT 'free',
    stripe_customer_id VARCHAR(255),
    api_key VARCHAR(255) UNIQUE,
    daily_search_count INTEGER DEFAULT 0,
    search_count_reset_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE products (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    marketplace VARCHAR(20) DEFAULT 'amazon',
    external_id VARCHAR(100) NOT NULL,
    title TEXT NOT NULL,
    current_price DECIMAL(10,2),
    currency VARCHAR(3) DEFAULT 'USD',
    image_url TEXT,
    category VARCHAR(255),
    sales_rank INTEGER,
    review_count INTEGER,
    rating DECIMAL(3,2),
    last_updated TIMESTAMP DEFAULT NOW(),
    UNIQUE(marketplace, external_id)
);

CREATE TABLE product_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID REFERENCES products(id) ON DELETE CASCADE,
    price DECIMAL(10,2),
    sales_rank INTEGER,
    review_count INTEGER,
    rating DECIMAL(3,2),
    recorded_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_product_history_product_date 
ON product_history(product_id, recorded_at);

CREATE TABLE watchlists (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    product_id UUID REFERENCES products(id) ON DELETE CASCADE,
    list_name VARCHAR(100) DEFAULT 'default',
    added_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, product_id)
);

CREATE TABLE trend_scores (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    product_id UUID REFERENCES products(id) ON DELETE CASCADE,
    score INTEGER CHECK (score >= 0 AND score <= 100),
    label VARCHAR(20),
    rank_velocity_score DECIMAL(5,2),
    price_momentum_score DECIMAL(5,2),
    review_growth_score DECIMAL(5,2),
    calculated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_trend_scores_product 
ON trend_scores(product_id, calculated_at);

CREATE TABLE alerts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    product_id UUID REFERENCES products(id) ON DELETE CASCADE,
    alert_type VARCHAR(50),
    message TEXT,
    is_read BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE search_history (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    query TEXT,
    searched_at TIMESTAMP DEFAULT NOW()
);
```

-----

## API ENDPOINTS

### Authentication

- `POST /api/v1/auth/register`
- `POST /api/v1/auth/login`
- `POST /api/v1/auth/logout`
- `POST /api/v1/auth/forgot-password`
- `POST /api/v1/auth/reset-password`

### Users

- `GET /api/v1/user/profile`
- `PUT /api/v1/user/profile`
- `GET /api/v1/user/subscription`
- `GET /api/v1/user/usage-stats`

### Products

- `GET /api/v1/products/search?q={query}&category={cat}&sort={field}&page={n}`
- `GET /api/v1/products/:id`
- `GET /api/v1/products/:id/history?days={n}`
- `GET /api/v1/products/:id/competitors`

### Trending

- `GET /api/v1/trending?category={cat}&limit={n}`
- `GET /api/v1/trending/categories`

### Watchlist

- `GET /api/v1/watchlist`
- `POST /api/v1/watchlist`
- `DELETE /api/v1/watchlist/:productId`
- `POST /api/v1/watchlist/export`

### Alerts

- `GET /api/v1/alerts`
- `PUT /api/v1/alerts/:id/read`
- `DELETE /api/v1/alerts/:id`
- `POST /api/v1/alerts/mark-all-read`

### Subscriptions

- `POST /api/v1/subscriptions/create-checkout-session`
- `POST /api/v1/subscriptions/webhook`
- `PUT /api/v1/subscriptions/upgrade`
- `PUT /api/v1/subscriptions/cancel`

-----

## PYTHON ML SERVICE

```python
from flask import Flask, request, jsonify
import numpy as np

app = Flask(__name__)

@app.route('/calculate-trend', methods=['POST'])
def calculate_trend():
    data = request.json
    history = data['history']  # Last 30 days
    
    current = history[-1]
    day_7 = history[-7] if len(history) >= 7 else current
    day_30 = history[0]
    
    # Sales Rank Velocity (40%)
    if day_7['sales_rank'] and current['sales_rank']:
        rank_vel_7d = (day_7['sales_rank'] - current['sales_rank']) / day_7['sales_rank']
    else:
        rank_vel_7d = 0
    
    if day_30['sales_rank'] and current['sales_rank']:
        rank_vel_30d = (day_30['sales_rank'] - current['sales_rank']) / day_30['sales_rank']
    else:
        rank_vel_30d = 0
    
    rank_score = (rank_vel_7d * 0.6 + rank_vel_30d * 0.4) * 100
    
    # Price Momentum (30%)
    if day_30['price'] and current['price']:
        price_change = (current['price'] - day_30['price']) / day_30['price']
        price_score = -price_change * 100  # Inverse: drops are good
    else:
        price_score = 0
    
    # Review Growth (30%)
    if day_30['review_count'] and current['review_count']:
        review_growth = (current['review_count'] - day_30['review_count']) / max(day_30['review_count'], 1)
        review_score = min(review_growth * 100, 100)
    else:
        review_score = 0
    
    # Weighted score
    total_score = (rank_score * 0.4 + price_score * 0.3 + review_score * 0.3)
    final_score = max(0, min(100, total_score))
    
    # Label
    if final_score >= 80:
        label = "hot"
    elif final_score >= 60:
        label = "rising"
    elif final_score >= 40:
        label = "stable"
    else:
        label = "declining"
    
    return jsonify({
        "score": round(final_score, 1),
        "label": label,
        "breakdown": {
            "rank_velocity": round(rank_score, 1),
            "price_momentum": round(price_score, 1),
            "review_growth": round(review_score, 1)
        }
    })

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
```

-----

## REACT NATIVE COMPONENTS

### ProductCard.tsx

```typescript
interface ProductCardProps {
  product: Product;
  onPress: () => void;
}

export const ProductCard: React.FC<ProductCardProps> = ({ product, onPress }) => {
  return (
    <TouchableOpacity onPress={onPress} style={styles.card}>
      <Image source={{ uri: product.imageUrl }} style={styles.image} />
      <View style={styles.content}>
        <Text style={styles.title} numberOfLines={2}>{product.title}</Text>
        <Text style={styles.price}>${product.currentPrice}</Text>
        <TrendBadge score={product.trendScore} label={product.trendLabel} />
        <View style={styles.stats}>
          <Text>BSR: {product.salesRank}</Text>
          <Text>⭐ {product.rating} ({product.reviewCount})</Text>
        </View>
      </View>
    </TouchableOpacity>
  );
};
```

### TrendBadge.tsx

```typescript
export const TrendBadge: React.FC<{score: number; label: string}> = ({ score, label }) => {
  const getColor = () => {
    if (score >= 80) return '#10B981';
    if (score >= 60) return '#F59E0B';
    if (score >= 40) return '#6B7280';
    return '#EF4444';
  };

  return (
    <View style={[styles.badge, { backgroundColor: getColor() }]}>
      <Text style={styles.badgeText}>{label.toUpperCase()}</Text>
      <Text style={styles.scoreText}>{score}</Text>
    </View>
  );
};
```

-----

## CRON JOBS

1. **Product Data Updater** (every 6 hours)
- Fetch latest data for tracked products
- Update products and product_history tables
1. **Trend Score Calculator** (every 6 hours)
- Calculate trend scores for all products
- Trigger alerts for significant changes
1. **Alert Generator** (hourly)
- Check for price drops, rank changes
- Send push notifications
1. **Search Counter Reset** (daily at midnight)
- Reset daily_search_count for all users
1. **Cleanup** (weekly)
- Delete old product_history (>1 year)
- Delete old read alerts (>30 days)

-----

## ENVIRONMENT VARIABLES

```env
DATABASE_URL=postgresql://user:pass@host:5432/trendscope
REDIS_URL=redis://host:6379

AMAZON_ACCESS_KEY=your_key
AMAZON_SECRET_KEY=your_secret
AMAZON_PARTNER_TAG=your_tag

STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_PRICE_ID_STARTER=price_...
STRIPE_PRICE_ID_PRO=price_...

FIREBASE_API_KEY=your_key
FIREBASE_PROJECT_ID=your_project

JWT_SECRET=your_secret
JWT_EXPIRY=7d

APP_URL=https://trendscope.app
API_URL=https://api.trendscope.app
ML_SERVICE_URL=http://localhost:5000
```

-----

## DELIVERABLES

1. Complete React Native mobile app (iOS + Android)
1. Node.js backend API with all endpoints
1. Python ML service for trend calculations
1. PostgreSQL database with schema and migrations
1. Stripe subscription integration
1. Firebase authentication
1. Amazon PA-API integration
1. Push notification system
1. All charts and data visualizations
1. Cron jobs for automation
1. API documentation
1. Deployment configuration

**BUILD THE COMPLETE FUNCTIONAL APP WITH ALL FEATURES LISTED ABOVE.**